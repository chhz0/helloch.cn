---
prev:
  text: 'æ•°æ®ç±»å‹ - Hash'
  link: 'redis/data-types/Hashes'
next:
  text: 'æ•°æ®ç±»å‹ - Stream'
  link: '/redis/data-types/Stream'
---
# ZSet <Badge type="tip" text="Redis Sorted Set" />

Redis ZSet æ˜¯ä¸€ä¸ªå…³è”åˆ†æ•°æ’åºçš„å”¯ä¸€å­—ç¬¦ä¸²é›†åˆ. å½“å¤šä¸ªå­—ç¬¦ä¸²å…·æœ‰ç›¸åŒåˆ†æ•°æ—¶ï¼Œå­—ç¬¦ä¸²ä¼šæŒ‰ç…§å­—å…¸é¡ºåºæ’åˆ—ã€‚

`ZSet`å¯ä»¥é€‚ç”¨äº:
- æ’è¡Œæ¦œ. ä½¿ç”¨ZSetç»´æŠ¤å¤§å‹æ¸¸æˆä¸­æœ€é«˜åˆ†æ•°çš„æœ‰åºåˆ—è¡¨.
- é€Ÿç‡é™åˆ¶å™¨. ä½¿ç”¨ZSetæ„å»ºæ»‘åŠ¨çª—å£é€Ÿç‡é™åˆ¶å™¨ï¼Œä»¥é˜²æ­¢è¿‡å¤šçš„APIè¯·æ±‚.

`ZSet`å¯ä»¥è§†ä¸ºæ˜¯é›†åˆå’Œå“ˆå¸Œçš„æ··åˆï¼Œä¸€æ–¹é¢ï¼Œå…¶ä¸é›†åˆç±»ä¼¼ï¼Œç”±å”¯ä¸€çš„ã€ä¸é‡å¤çš„å­—ç¬¦ä¸²å…ƒç´ ç»„æˆï¼›å¦ä¸€æ–¹é¢ï¼Œé›†åˆå†…å…ƒç´ æ²¡æœ‰æ’åºï¼Œä½†æ˜¯æ’åºé›†åˆä¸­æ¯ä¸ªå…ƒç´ éƒ½å’Œä¸€ä¸ªæµ®ç‚¹å€¼ç›¸å…³è”ï¼Œä¹Ÿå°±æ˜¯ç±»ä¼¼äºå“ˆå¸Œï¼Œæ¯ä¸ªå…ƒç´ æ˜ å°„ä¸€ä¸ªå€¼

æ­¤å¤–ï¼Œæ’åºé›†ä¸­çš„å…ƒç´ æ˜¯æŒ‰é¡ºåºè·å–çš„ï¼Œè¿™ä¸ªé¡ºåºéµå®ˆä»¥ä¸‹è§„åˆ™ï¼š
1. å¦‚æœ B å’Œ A æ˜¯å…·æœ‰ä¸åŒåˆ†æ•°çš„ä¸¤ä¸ªå…ƒç´ ï¼Œåˆ™å¦‚æœ A.score æ˜¯ > B.scoreï¼Œåˆ™ A > B.
2. å¦‚æœ B å’Œ A çš„åˆ†æ•°å®Œå…¨ç›¸åŒï¼Œåˆ™å¦‚æœ A å­—ç¬¦ä¸²æŒ‰å­—å…¸é¡ºåºå¤§äº B å­—ç¬¦ä¸²ï¼Œåˆ™ A > Bã€‚ B å’Œ A å­—ç¬¦ä¸²ä¸èƒ½ç›¸ç­‰ï¼Œå› ä¸ºæ’åºé›†ä»…å…·æœ‰å”¯ä¸€å…ƒç´ 

## ZSet å‘½ä»¤

ZSetå¸¸è§å‘½ä»¤ï¼š
- åˆ›å»ºï¼š`ZADD`
  - `ZADD key score member [score member]` # å‘Sorted Setå¢åŠ æ•°æ®ï¼Œå¦‚æœkeyå·²ç»å­˜åœ¨çš„Keyï¼Œåˆ™æ›´æ–°å¯¹åº”çš„æ•°æ®
    - æ‰©å±•å‚æ•°ï¼šXX, NX, LT, GT
- æŸ¥è¯¢ï¼š`ZRANGE`, `ZCOUNT`, `ZRANK`, `ZCARD`, `ZSCORE`
  - `ZCARD key` # æŸ¥çœ‹ZSetä¸­çš„æˆå‘˜
  - `ZRANGE key start stop [WITHSCORES]` # æŸ¥è¯¢ä»startåˆ°stopèŒƒå›´çš„ZSetæ•°æ®ï¼ŒWITHSCORESé€‰å¡«ï¼Œä¸å†™è¾“å‡ºé‡Œåªæœ‰keyï¼Œæ²¡æœ‰scoreå€¼
  - `ZREVRANGE key start stop [WITHSCORES]` # å³reverse rangeï¼Œä»å¤§åˆ°å°éå†ï¼ŒWITHSCORESé€‰é¡¹ï¼Œä¸å†™ä¸ä¼šè¾“å‡ºscore
  - `ZCOUNT key min max` # è®¡ç®—min-maxç§¯åˆ†èŒƒå›´çš„æˆå‘˜
  - `ZRANK key member` # æŸ¥çœ‹ZSetä¸­memberçš„æ’åç´¢å¼•ï¼Œç´¢å¼•ä»0å¼€å§‹ï¼Œæ‰€ä»¥æ’åæ˜¯ç¬¬ä¸€ï¼Œç´¢å¼•å°±æ˜¯0
  - `ZSCORE key member` # æŸ¥è¯¢ZSetæˆå‘˜çš„åˆ†æ•°
- æ›´æ–°ï¼š`ZADD`, `ZREM`
  - `ZREM key member [member ...]` # åˆ é™¤ZSetä¸­çš„å…ƒç´ 
- åˆ é™¤ï¼š`DEL`, `UNLINK`

::: tip è¯¦ç»†ZSetå‘½ä»¤
ğŸ”— [ZSetså‘½ä»¤åˆ—è¡¨](https://redis.io/docs/latest/commands/?group=sorted-set)
:::

## ZSet ç¼–ç (åº•å±‚å®ç°)

ZSetåº•å±‚ç¼–ç æœ‰ä¸¤ç§ï¼š`ZIPLIST`ï¼Œ `SKIPLIST`+`HASHTABLE`

- `ZIPLIST`
  - åˆ—è¡¨å¯¹è±¡ä¿å­˜çš„æ‰€æœ‰å­—ç¬¦ä¸²å¯¹è±¡é•¿åº¦éƒ½å°äº64å­—èŠ‚ï¼Œä¸”åˆ—è¡¨å¯¹è±¡å…ƒç´ ä¸ªæ•°å°‘äº128ä¸ª
  - ä½¿ç”¨`ZIPLIST`çš„ç›®çš„æ˜¯åœ¨æ•°æ®é‡å°çš„æ—¶å€™èŠ‚çœå†…å­˜ï¼Œåœ¨ç´§å‡‘çš„ç»“æ„ä¸­ä»¥`value`+`score`çš„å½¢å¼å­˜æ”¾è¿›`ziplist.entry`

å½“ä¸Šè¿°æ¡ä»¶ä¸ç¬¦åˆçš„æ—¶å€™ï¼Œç¼–ç ä½¿ç”¨`SKIPLIST`+`HASHTABLE`

SKIPLISTæ˜¯ä¸€ç§å¯ä»¥å¿«é€ŸæŸ¥æ‰¾çš„å¤šçº§é“¾è¡¨ç»“æ„ï¼Œé€šè¿‡SKIPLISTå¯ä»¥å¿«é€Ÿå®šä½åˆ°æ•°æ®æ‰€åœ¨ï¼Œå®ƒçš„æ’åæ“ä½œã€èŒƒå›´æŸ¥è¯¢æ€§èƒ½éƒ½å¾ˆé«˜

> [!NOTE] ç¼–ç è¯¦è§£
> ğŸ”— [æŸ¥çœ‹SKIPLISTç¼–ç ](./encoding-skip-list)